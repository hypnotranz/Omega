# Session Server Architecture - Beads Feature Definitions
# This file defines the dependency graph for parallel execution

features:
  # ─────────────────────────────────────────────────────────────────
  # LAYER 0: Foundation (no dependencies)
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019-types"
    title: "Shared Types and Interfaces"
    description: "Define all TypeScript interfaces and types for the Session Server"
    job_file: "019-types.md"
    depends_on: []
    estimated_hours: 1.5
    tags: ["foundation", "types", "interfaces"]
    
  # ─────────────────────────────────────────────────────────────────
  # LAYER 1: Core Data Structures (depend only on types)
  # All can run in PARALLEL
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019a1-config"
    title: "Server Configuration"
    description: "Environment-based configuration loading and validation"
    job_file: "019a1-config.md"
    depends_on: ["019-types"]
    estimated_hours: 1
    tags: ["core", "config"]
    
  - id: "019a2-session-instance"
    title: "SessionInstance Wrapper"
    description: "Wrapper class for ReplState with metadata and change tracking"
    job_file: "019a2-session-instance.md"
    depends_on: ["019-types"]
    estimated_hours: 2
    tags: ["core", "session"]
    
  - id: "019a3-session-pool"
    title: "LRU Session Cache"
    description: "In-memory session cache with LRU eviction"
    job_file: "019a3-session-pool.md"
    depends_on: ["019-types"]
    estimated_hours: 1.5
    tags: ["core", "cache"]
    
  - id: "019a4-incremental-writer"
    title: "Incremental File Writer"
    description: "Optimized append-only file writing for session events"
    job_file: "019a4-incremental-writer.md"
    depends_on: ["019-types"]
    estimated_hours: 2
    tags: ["core", "persistence"]

  # ─────────────────────────────────────────────────────────────────
  # LAYER 2: Managers (depend on Layer 1)
  # 019b1 and 019b3 can run in PARALLEL
  # 019b2 depends on 019b1
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019b1-persistence-manager"
    title: "Persistence Manager"
    description: "Background saving coordination and dirty session tracking"
    job_file: "019b1-persistence-manager.md"
    depends_on: ["019a3-session-pool", "019a4-incremental-writer"]
    estimated_hours: 2.5
    tags: ["manager", "persistence"]
    
  - id: "019b2-session-manager"
    title: "Session Manager"
    description: "Session lifecycle management integrating pool and persistence"
    job_file: "019b2-session-manager.md"
    depends_on: ["019a2-session-instance", "019a3-session-pool", "019b1-persistence-manager"]
    estimated_hours: 3.5
    tags: ["manager", "session"]
    
  - id: "019b3-process-manager"
    title: "Process Manager"
    description: "Server process lifecycle (start, stop, health check)"
    job_file: "019b3-process-manager.md"
    depends_on: ["019-types"]
    estimated_hours: 2
    tags: ["manager", "process"]

  # ─────────────────────────────────────────────────────────────────
  # LAYER 3: Server & API (depend on Layer 2)
  # Sequential: 019c1 then 019c2
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019c1-api-routes"
    title: "API Routes"
    description: "REST endpoint definitions for session operations"
    job_file: "019c1-api-routes.md"
    depends_on: ["019b2-session-manager"]
    estimated_hours: 2
    tags: ["server", "api"]
    
  - id: "019c2-session-server"
    title: "Session Server"
    description: "Main Express application tying all components together"
    job_file: "019c2-session-server.md"
    depends_on: ["019a1-config", "019b2-session-manager", "019c1-api-routes"]
    estimated_hours: 2
    tags: ["server", "main"]

  # ─────────────────────────────────────────────────────────────────
  # LAYER 4: Client (can develop against API contract)
  # 019d1 and 019d2 can run in PARALLEL
  # 019d3 depends on both
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019d1-session-client"
    title: "Session Client"
    description: "HTTP client for server communication with retry logic"
    job_file: "019d1-session-client.md"
    depends_on: ["019-types"]  # Can develop against interface contract
    estimated_hours: 2
    tags: ["client", "http"]
    
  - id: "019d2-client-process-manager"
    title: "Client Process Manager"
    description: "Auto-start server from client side"
    job_file: "019d2-client-process-manager.md"
    depends_on: ["019-types"]  # Can develop against interface contract
    estimated_hours: 1.5
    tags: ["client", "process"]
    
  - id: "019d3-repl-integration"
    title: "REPL Integration"
    description: "Adapt omega-repl.ts to use Session Server"
    job_file: "019d3-repl-integration.md"
    depends_on: ["019d1-session-client", "019d2-client-process-manager", "019c2-session-server"]
    estimated_hours: 3.5
    tags: ["client", "integration"]

  # ─────────────────────────────────────────────────────────────────
  # LAYER 5: Advanced Features (all independent - can run in PARALLEL)
  # ─────────────────────────────────────────────────────────────────
  
  - id: "019e1-concurrency-manager"
    title: "Concurrency Manager"
    description: "Multi-client access control with read/write locking"
    job_file: "019e1-concurrency-manager.md"
    depends_on: ["019-types"]
    estimated_hours: 1.5
    tags: ["advanced", "concurrency"]
    
  - id: "019e2-session-monitor"
    title: "Session Monitor"
    description: "Metrics and statistics tracking"
    job_file: "019e2-session-monitor.md"
    depends_on: ["019-types"]
    estimated_hours: 1
    tags: ["advanced", "metrics"]
    
  - id: "019e3-snapshot-manager"
    title: "Snapshot Manager"
    description: "Session snapshots for quick restore points"
    job_file: "019e3-snapshot-manager.md"
    depends_on: ["019-types"]
    estimated_hours: 1.5
    tags: ["advanced", "snapshots"]
    
  - id: "019e4-timeline-navigator"
    title: "Timeline Navigator"
    description: "Enhanced checkpoint navigation with annotations"
    job_file: "019e4-timeline-navigator.md"
    depends_on: ["019-types"]
    estimated_hours: 1.5
    tags: ["advanced", "timeline"]

# ─────────────────────────────────────────────────────────────────
# Execution Summary
# ─────────────────────────────────────────────────────────────────
#
# Total estimated hours: ~32 hours
#
# Parallel execution waves:
#
# Wave 1 (1 job):     019-types
# Wave 2 (8 jobs):    019a1, 019a2, 019a3, 019a4, 019b3, 019d1, 019d2, 019e1-e4
# Wave 3 (1 job):     019b1
# Wave 4 (1 job):     019b2
# Wave 5 (1 job):     019c1
# Wave 6 (1 job):     019c2
# Wave 7 (1 job):     019d3
#
# With 4 parallel agents, estimated wall-clock time: ~12 hours
# ─────────────────────────────────────────────────────────────────
